# 実装タスクリスト

## 概要

このタスクリストは、kiro-card-kitの実装を段階的に進めるためのものです。各タスクは要件定義書とデザイン文書に基づいており、コア機能の実装に焦点を当てています。

## タスク

- [x] 1. プロジェクトのセットアップと基本構造の構築
  - Next.jsプロジェクトを作成し、必要な依存関係をインストール
  - TypeScript、Tailwind CSS、Lucide Reactを設定
  - Jest + React Testing Libraryを設定
  - ディレクトリ構造を作成（app、components、lib、types、public）
  - 基本的なレイアウトコンポーネントを実装
  - モバイルファースト設計を考慮したレスポンシブ設定
  - _要件: 11.1, 11.2, 12.1, 12.2, 12.3, 12.4_

- [x] 2. TypeScript型定義の作成
  - `types/evaluator.ts`にEvaluator型を定義
  - `types/card.ts`にCardData型を定義
  - `types/discussion.ts`にDiscussionMessage型を定義
  - 画像解析結果の型（ImageFeatures）を定義
  - _要件: 3.1, 5.6_

- [x] 3. 評議員テンプレートシステムの実装
  - [x] 3.1 評議員テンプレートJSONファイルの作成
    - `public/templates/evaluators/`に4人分のJSONファイルを作成
    - カード名担当、フレーバー担当、属性担当、色・レア度担当の評議員を定義
    - Persona、Role、Responsibilityを含める
    - `/design`ディレクトリのモックアプリを参考にセリフや設定を定義
    - _要件: 8.1, 8.2, 8.3, 8.7_
  
  - [x] 3.2 評議員画像の設定
    - 評議員画像は`public/member/`に配置済み（1.png, 2.png, 3.png, 4.png）
    - 画像パス（/member/1.png等）をテンプレートJSONに設定
    - _要件: 8.4_
  
  - [x] 3.3 評議員テンプレートローダーの実装
    - `lib/templates/evaluatorLoader.ts`を作成
    - テンプレートJSONを読み込む関数を実装
    - テンプレートのバリデーション機能を実装
    - _要件: 8.1, 8.6_

- [x] 4. LocalStorageマネージャーの実装
  - `lib/storage/localStorageManager.ts`を作成
  - カードデータの保存機能を実装
  - カードデータの読み込み機能を実装
  - 最大100枚の制限を実装
  - 古いカードの自動削除機能を実装
  - _要件: 7.1, 7.6_

- [x] 5. Main Screenの基本レイアウト実装
  - `app/page.tsx`にMain Screenを実装
  - `/design`ディレクトリのモックアプリを参考にレイアウトを構築
  - モバイルファーストのレスポンシブデザインを実装
  - React Context + Hooksで状態管理を実装
  - _要件: 11.1, 11.2, 11.3, 11.4, 11.5, 12.1, 12.2, 12.3, 12.4_

- [x] 6. 画像アップロード機能の実装
  - [x] 6.1 ImageUploaderコンポーネントの作成
    - `components/main/ImageUploader.tsx`を作成
    - ファイル選択ダイアログ機能を実装
    - ドラッグ&ドロップ機能を実装
    - JPEG、PNG、WEBP形式のサポート
    - _要件: 1.1, 1.2, 1.3, 1.4, 1.5_
  
  - [x] 6.2 画像バリデーションの実装
    - `lib/utils/validation.ts`を作成
    - ファイルサイズ制限（10MB）のチェック
    - ファイル形式のチェック
    - エラーメッセージ表示機能
    - _要件: 1.6_

- [x] 7. 評議員パネルとアバターの実装
  - `components/main/EvaluatorPanel.tsx`を作成
  - 4人の評議員を表示
  - 評議員画像を表示
  - `/design`ディレクトリのモックアプリを参考にレイアウトを実装
  - _要件: 4.1, 4.2_

- [x] 8. 画像解析APIの実装
  - [x] 8.1 Vision APIサービスの作成
    - `lib/services/visionService.ts`を作成
    - OpenAI Vision APIを使用した画像解析機能を実装
    - 物体の種類、色、形状、材質、詳細な説明を抽出
    - _要件: 2.1, 2.3_
  
  - [x] 8.2 画像解析APIエンドポイントの作成
    - `app/api/analyze-image/route.ts`を作成
    - POST リクエストを受け付ける
    - 画像をVision APIに送信し、結果を返す
    - エラーハンドリングを実装
    - _要件: 2.1, 2.4, 2.6_

- [x] 9. 議論表示の実装
  - [x] 9.1 DiscussionStageコンポーネントの作成
    - `components/discussion/DiscussionStage.tsx`を作成
    - `/design`ディレクトリのモックアプリを参考に議論表示を実装
    - _要件: 4.1, 4.2_
  
  - [x] 9.2 Thinking Phase表示の実装
    - 画像解析中の表示を実装
    - 画像解析処理を並行実行
    - _要件: 2.2_

- [x] 10. カード要素生成APIの実装
  - [x] 10.1 カード生成サービスの作成
    - `lib/services/cardGenerationService.ts`を作成
    - Vercel AI SDKを使用したAI機能を実装
    - 各評議員の責任に応じた生成ロジックを実装
    - _要件: 3.1_
  
  - [x] 10.2 カード要素生成APIエンドポイントの作成
    - `app/api/generate-card-elements/route.ts`を作成
    - POST リクエストを受け付ける
    - 評議員の責任（name、flavor、attribute、color-rarity）に応じて生成
    - 評議員の発言メッセージも生成
    - _要件: 3.4, 3.5, 3.6, 3.7_

- [x] 11. 議論オーケストレーターの実装
  - `lib/services/discussionOrchestrator.ts`を作成
  - 画像解析結果を全評議員で共有
  - 4人の評議員のカード要素生成を並列実行
  - 各評議員の生成結果を収集
  - _要件: 2.5, 3.3, 3.8, 3.9, 10.1, 10.3_

- [x] 12. 吹き出しコンポーネントの実装
  - `components/discussion/SpeechBubble.tsx`を作成
  - 評議員の発言を吹き出し形式で表示
  - `/design`ディレクトリのモックアプリを参考にデザインを実装
  - 4人の発言を並列で表示
  - _要件: 4.4, 4.5_

- [-] 13. カードデータ統合機能の実装
  - 各評議員の生成結果を統合
  - カード名、フレーバーテキスト、属性、色・レア度を採用
  - 統合したカードデータをJSON形式で保存
  - 議論ログを保存
  - _要件: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 4.7_

- [ ] 14. 「結果を見る！」ボタンの実装
  - 全評議員の生成完了時にボタンを表示
  - ボタンクリックでCard Modalを開く
  - _要件: 4.6, 10.4, 11.5, 11.6_

- [ ] 15. CardDisplayコンポーネントの実装
  - `components/card/CardDisplay.tsx`を作成
  - TCG風のカードUIを実装
  - カード名、属性、レア度、フレーバーテキストを表示
  - アップロードされた画像をカード内に配置
  - `/design`ディレクトリのモックアプリを参考にデザインを実装
  - モバイルファーストのレスポンシブ対応
  - _要件: 6.2, 6.3, 12.1, 12.2, 12.3, 12.4_

- [ ] 16. Card Modalの実装
  - `components/card/CardModal.tsx`を作成
  - モーダルの基本構造を実装
  - 閉じるボタンを実装
  - `/design`ディレクトリのモックアプリを参考にデザインを実装
  - _要件: 6.1, 6.4_

- [ ] 17. カードエクスポート機能の実装
  - `components/card/CardExporter.tsx`を作成
  - カードをJPG形式で画像化
  - ダウンロード機能を実装
  - _要件: 7.2_

- [ ] 18. コレクションサイドバーの実装
  - `components/main/CollectionSidebar.tsx`を作成
  - `/design`ディレクトリのモックアプリを参考にレイアウトを実装
  - LocalStorageからカードデータを読み込み
  - カードを日付順に表示
  - カードクリックでCard Modalを表示
  - _要件: 7.3, 7.4, 7.5_

- [ ] 19. エラーハンドリングの実装
  - [ ] 19.1 エラーハンドリングサービスの作成
    - `lib/utils/errorHandler.ts`を作成
    - CardGenerationErrorクラスを定義
    - エラーログ出力機能を実装
    - _要件: 9.6_
  
  - [ ] 19.2 エラーメッセージ機能の実装
    - Vision API解析失敗時のエラーメッセージ
    - AI生成失敗時のエラーメッセージ
    - 議論を自然に終了させる機能
    - Main Screenの初期状態に戻る機能
    - _要件: 9.1, 9.2, 9.3, 9.4_
  
  - [ ] 19.3 ネットワークエラー通知の実装
    - オフライン状態の通知
    - リトライ機能
    - _要件: 9.5_
  
  - [ ] 19.4 ユーザーフレンドリーなエラーメッセージの実装
    - 日本語でのエラーメッセージ表示
    - トースト通知コンポーネントの作成
    - _要件: 9.7_

- [ ] 20. パフォーマンス最適化
  - 画像のリサイズ処理を実装（最大1024x1024）
  - 画像解析と議論生成の非同期並列実行を確認
  - モバイルブラウザでのパフォーマンスを確認
  - _要件: 10.1, 10.2_

- [ ] 21. テストの実装
  - [ ] 21.1 コンポーネントテストの作成
    - 各UIコンポーネントのテストを作成
    - ファイル単位で小さなテストを作成
    - _テスト戦略_
  
  - [ ] 21.2 サービステストの作成
    - カード生成ロジックのテストを作成
    - LocalStorage操作のテストを作成
    - テンプレート読み込みのテストを作成
    - _テスト戦略_
  
  - [ ] 21.3 ユーティリティテストの作成
    - バリデーション関数のテストを作成
    - データ変換関数のテストを作成
    - _テスト戦略_

- [ ] 22. 環境変数とデプロイ設定
  - `.env.local`ファイルを作成
  - OPENAI_API_KEY、NEXT_PUBLIC_APP_URL、NEXT_PUBLIC_MAX_CARDSを設定
  - Vercelデプロイ用の設定を確認
