# 実装タスクリスト

## 概要

このタスクリストは、kiro-card-kitの実装を段階的に進めるためのものです。各タスクは要件定義書とデザイン文書に基づいており、コア機能の実装に焦点を当てています。

## タスク

- [x] 1. プロジェクトのセットアップと基本構造の構築
  - Next.jsプロジェクトを作成し、必要な依存関係をインストール
  - TypeScript、Tailwind CSS、Motion、Lucide Reactを設定
  - ディレクトリ構造を作成（app、components、lib、types、public）
  - 基本的なレイアウトコンポーネントを実装
  - _要件: 12.1, 12.2, 13.1, 13.2_

- [x] 2. TypeScript型定義の作成
  - `types/evaluator.ts`にEvaluator型を定義
  - `types/card.ts`にCardData、CardSkin型を定義
  - `types/discussion.ts`にDiscussionMessage型を定義
  - 画像解析結果の型（ImageFeatures）を定義
  - _要件: 3.1, 5.6_

- [x] 3. 評議員テンプレートシステムの実装
  - [x] 3.1 評議員テンプレートJSONファイルの作成
    - `public/templates/evaluators/`に4人分のJSONファイルを作成
    - カード名担当、フレーバー担当、属性担当、色・レア度担当の評議員を定義
    - Persona、Role、Responsibility、SpeechPattern、OpeningDialoguesを含める
    - _要件: 8.1, 8.2, 8.3, 8.4, 8.8_
  
  - [x] 3.2 評議員画像の設定
    - 評議員画像は`public/member/`に配置済み（1.png, 2.png, 3.png, 4.png）
    - 画像パス（/member/1.png等）をテンプレートJSONに設定
    - _要件: 8.5_
  
  - [x] 3.3 評議員テンプレートローダーの実装
    - `lib/templates/evaluatorLoader.ts`を作成
    - テンプレートJSONを読み込む関数を実装
    - テンプレートのバリデーション機能を実装
    - _要件: 8.1, 8.7_

- [x] 4. LocalStorageマネージャーの実装
  - `lib/storage/localStorageManager.ts`を作成
  - カードデータの保存機能を実装
  - カードデータの読み込み機能を実装
  - 最大100枚の制限を実装
  - 古いカードの自動削除機能を実装
  - _要件: 7.1, 7.6_

- [x] 5. Main Screenの基本レイアウト実装
  - `app/page.tsx`にMain Screenを実装
  - 左側に評議員パネル、中央に画像アップロードエリア、右側にコレクションサイドバーを配置
  - React Context + Hooksで状態管理を実装
  - _要件: 12.1, 12.2, 12.3, 12.4, 12.5_

- [x] 6. 画像アップロード機能の実装
  - [x] 6.1 ImageUploaderコンポーネントの作成
    - `components/main/ImageUploader.tsx`を作成
    - ファイル選択ダイアログ機能を実装
    - ドラッグ&ドロップ機能を実装
    - JPEG、PNG、WEBP形式のサポート
    - _要件: 1.1, 1.2, 1.3, 1.4, 1.5_
  
  - [x] 6.2 画像バリデーションの実装
    - `lib/utils/validation.ts`を作成
    - ファイルサイズ制限（10MB）のチェック
    - ファイル形式のチェック
    - エラーメッセージ表示機能
    - _要件: 1.6_

- [x] 7. 評議員パネルとアバターの実装
  - `components/main/EvaluatorPanel.tsx`を作成
  - 4人の評議員を左側に縦並びで表示
  - 評議員画像を表示
  - 待機状態のレイアウトを実装
  - _要件: 4.1, 4.2, 12.3_

- [x] 8. 画像解析APIの実装
  - [x] 8.1 Vision APIサービスの作成
    - `lib/services/visionService.ts`を作成
    - OpenAI Vision APIを使用した画像解析機能を実装
    - 物体の種類、色、形状、材質、詳細な説明を抽出
    - _要件: 2.1, 2.3_
  
  - [x] 8.2 画像解析APIエンドポイントの作成
    - `app/api/analyze-image/route.ts`を作成
    - POST リクエストを受け付ける
    - 画像をVision APIに送信し、結果を返す
    - エラーハンドリングを実装
    - _要件: 2.1, 2.4, 2.6_

- [x] 9. 評議員アニメーションの実装
  - [x] 9.1 DiscussionStageコンポーネントの作成
    - `components/discussion/DiscussionStage.tsx`を作成
    - Motionを使用したアニメーション設定
    - 評議員の待機位置と議論位置を定義
    - _要件: 4.3_
  
  - [x] 9.2 評議員移動アニメーションの実装
    - 開始ボタン押下時に画像を中央に配置
    - 評議員を画像の四隅にスムーズに移動
    - トコトコ歩くような自然な動きを実装
    - _要件: 4.4, 4.5, 4.6, 4.7, 12.6, 12.7_
  
  - [x] 9.3 Opening Dialogueの実装
    - 複数のOpening Dialogueを用意
    - ランダムに選択して表示
    - _要件: 4.8, 4.9, 4.10_
  
  - [x] 9.4 Thinking Phaseアニメーションの実装
    - 4人全員が考えているアニメーションを実装
    - 画像解析処理を並行実行
    - _要件: 2.2, 4.11, 4.12_

- [x] 10. カード要素生成APIの実装
  - [x] 10.1 カード生成サービスの作成
    - `lib/services/cardGenerationService.ts`を作成
    - Vercel AI SDKを使用したAI機能を実装
    - 各評議員の責任に応じた生成ロジックを実装
    - _要件: 3.1_
  
  - [x] 10.2 カード要素生成APIエンドポイントの作成
    - `app/api/generate-card-elements/route.ts`を作成
    - POST リクエストを受け付ける
    - 評議員の責任（name、flavor、attribute、color-rarity）に応じて生成
    - 評議員の発言メッセージも生成
    - _要件: 3.4, 3.5, 3.6, 3.7_

- [x] 11. 議論オーケストレーターの実装
  - `lib/services/discussionOrchestrator.ts`を作成
  - 画像解析結果を全評議員で共有
  - 4人の評議員のカード要素生成を並列実行
  - 各評議員の生成結果を収集
  - _要件: 2.5, 3.3, 3.8, 3.9, 11.1, 11.3_

- [x] 12. 吹き出しコンポーネントの実装
  - `components/discussion/SpeechBubble.tsx`を作成
  - 評議員の発言を吹き出し形式で表示
  - Motionを使用したアニメーション
  - 4人の発言を並列で表示
  - _要件: 4.14, 4.15_

- [x] 13. カードデータ統合機能の実装
  - 各評議員の生成結果を統合
  - カード名、フレーバーテキスト、属性、色・レア度を採用
  - 統合したカードデータをJSON形式で保存
  - 議論ログを保存
  - _要件: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 4.17_

- [x] 14. 「結果を見る！」ボタンの実装
  - 全評議員の生成完了時にボタンを表示
  - ボタンクリックでCard Modalを開く
  - _要件: 4.16, 11.4, 12.9, 12.10_

- [x] 15. カードスキンシステムの実装
  - [x] 15.1 デフォルトカードスキンの作成
    - `public/templates/card-skins/default/`にスキン定義を作成
    - 背景画像、枠デザイン、属性アイコンを定義
    - _要件: 9.2, 9.5_
  
  - [x] 15.2 カードスキンローダーの実装
    - `lib/templates/skinLoader.ts`を作成
    - スキン定義を読み込む機能を実装
    - _要件: 9.1_

- [x] 16. CardDisplayコンポーネントの実装
  - `components/card/CardDisplay.tsx`を作成
  - TCG風のカードUIを実装
  - カード名、属性、レア度、フレーバーテキストを表示
  - 属性に応じた背景色・アイコンを適用
  - レア度に応じた枠デザイン・演出を適用
  - アップロードされた画像をカード内に配置
  - レスポンシブ対応
  - _要件: 6.3, 6.4, 6.5, 6.6, 6.7_

- [x] 17. Card Modalの実装
  - [x] 17.1 CardModalコンポーネントの作成
    - `components/card/CardModal.tsx`を作成
    - モーダルの基本構造を実装
    - 閉じるボタンを実装
    - _要件: 6.1, 6.8_
  
  - [x] 17.2 派手な演出の実装
    - フェードイン + スケールアニメーション
    - レア度に応じたパーティクルエフェクト
    - 背景のぼかし効果
    - _要件: 6.2_

- [x] 18. カードエクスポート機能の実装
  - `components/card/CardExporter.tsx`を作成
  - カードをJPG形式で画像化
  - ダウンロード機能を実装
  - _要件: 7.2_

- [x] 19. コレクションサイドバーの実装
  - `components/main/CollectionSidebar.tsx`を作成
  - Main Screenの右端に配置
  - LocalStorageからカードデータを読み込み
  - カードを日付順に表示
  - カードクリックでCard Modalを表示
  - _要件: 7.3, 7.4, 7.5_

- [x] 20. エラーハンドリングの実装
  - [x] 20.1 エラーハンドリングサービスの作成
    - `lib/utils/errorHandler.ts`を作成
    - CardGenerationErrorクラスを定義
    - エラーログ出力機能を実装
    - _要件: 10.7_
  
  - [x] 20.2 評議員の謝罪メッセージ機能の実装
    - Vision API解析失敗時の謝罪メッセージ
    - AI生成失敗時の謝罪メッセージ
    - 議論を自然に終了させる機能
    - Main Screenの初期状態に戻る機能
    - _要件: 10.1, 10.2, 10.3, 10.4, 10.5_
  
  - [x] 20.3 ネットワークエラー通知の実装
    - オフライン状態の通知
    - リトライ機能
    - _要件: 10.6_
  
  - [x] 20.4 ユーザーフレンドリーなエラーメッセージの実装
    - 日本語でのエラーメッセージ表示
    - トースト通知コンポーネントの作成
    - _要件: 10.8_

- [ ] 21. アクセシビリティ対応
  - ボタンとインタラクティブ要素のタッチターゲットサイズを確保
  - 色覚異常に配慮した色使いを実装
  - キーボードナビゲーションをサポート
  - ARIA属性を実装
  - _要件: 13.3, 13.4, 13.5, 13.6_

- [ ] 22. パフォーマンス最適化
  - 画像のリサイズ処理を実装（最大1024x1024）
  - 画像解析と議論生成の非同期並列実行を確認
  - アニメーションのGPU加速を確認
  - _要件: 11.1, 11.2_

- [ ] 23. 環境変数とデプロイ設定
  - `.env.local`ファイルを作成
  - OPENAI_API_KEY、NEXT_PUBLIC_APP_URL、NEXT_PUBLIC_MAX_CARDSを設定
  - Vercelデプロイ用の設定を確認
